<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MakersBnB - Book {{space.name}}</title>
    <link rel="stylesheet" href="/static/styles.css">
    <link rel="stylesheet" href="/static/booking.css">
</head>

<body>
    <header>
        <div class="container navbar">
            <a href="/" class="logo">MakersBnB</a>
            <div>
                {% if username == "Not logged in"%}
                <a href="/login" class="btn btn-secondary mr-2">Login</a>
                <a href="/register" class="btn">Register</a>
                {% else %}
                <span class="mr-3">Welcome, {{username}}</span>
                <a href="/user/{{username}}" class="btn btn-secondary">View Profile</a>
                <a href="/logout" class="btn btn-secondary">Log Out</a>
                {% endif %}
            </div>
        </div>
    </header>

    <main>
        <div class="container">
            <div class="mb-3">
                <a href="/spaces/{{space.id}}" class="btn btn-secondary btn-sm">&larr; Back to space details</a>
            </div>

            <div class="single-space mb-4">
                <div class="single-space-content">
                    <div class="single-space-header">
                        <h1 class="single-space-title">Book {{space.name}}</h1>
                        <p class="single-space-location">{{space.location}}</p>
                    </div>
                </div>
            </div>

            {% if username == "Not logged in" %}
            <div class="login-prompt">
                <p>Please <a href="/login">login</a> or <a href="/register">register</a> to book this space.</p>
            </div>
            {% else %}
            <div class="booking-container">
                <div class="booking-calendar">
                    <div class="calendar">
                        <div class="calendar-header">
                            <button id="prevMonth" class="btn btn-secondary btn-sm">&lt; Previous</button>
                            <div class="calendar-month" id="currentMonth">June 2025</div>
                            <button id="nextMonth" class="btn btn-secondary btn-sm">Next &gt;</button>
                        </div>
                        <div class="calendar-grid">
                            <div class="calendar-day-header">Sun</div>
                            <div class="calendar-day-header">Mon</div>
                            <div class="calendar-day-header">Tue</div>
                            <div class="calendar-day-header">Wed</div>
                            <div class="calendar-day-header">Thu</div>
                            <div class="calendar-day-header">Fri</div>
                            <div class="calendar-day-header">Sat</div>
                            <!-- Calendar days will be generated by JavaScript -->
                        </div>
                    </div>
                </div>

                <div class="booking-summary-container">
                    <div class="booking-summary">
                        <h3>Booking Summary</h3>
                        <div class="booking-details">
                            <p><strong>Check-in:</strong> <span id="check-in-date">Select a date</span></p>
                            <p><strong>Check-out:</strong> <span id="check-out-date">Select a date</span></p>
                            <p><strong>Nights:</strong> <span id="nights-count">0</span></p>
                        </div>
                        <div class="booking-price">
                            <span>£{{space.price_per_night}} x <span id="price-nights">0</span> nights</span>
                            <span id="subtotal">£0</span>
                        </div>
                        <div class="booking-price">
                            <span>Service fee</span>
                            <span id="service-fee">£0</span>
                        </div>
                        <div class="booking-total">
                            <span>Total</span>
                            <span id="total-price">£0</span>
                        </div>
                        <form action="/book/{{space.id}}/confirm" method="POST" id="booking-form">
                            <input type="hidden" name="space_id" value="{{space.id}}">
                            <input type="hidden" name="check_in_date" id="form-check-in">
                            <input type="hidden" name="check_out_date" id="form-check-out">
                            <input type="hidden" name="nights" id="form-nights">
                            <input type="hidden" name="total_price" id="form-total-price">
                            <button type="submit" id="confirm-booking" class="btn btn-lg btn-full mt-3" disabled>Confirm
                                Booking</button>
                        </form>
                    </div>
                </div>
            </div>
            {% endif %}
        </div>
    </main>

    <footer>
        <div class="container footer-content">
            <p>© 2025 MakersBnB, Inc.</p>
            <div class="footer-links">
                <a href="/">Home</a>
                <a href="/spaces">Spaces</a>
                <a href="/about">About</a>
                <a href="/contact">Contact</a>
            </div>
        </div>
    </footer>

    <!-- Pass data from backend to JavaScript -->
    <script>
        // Create a global variable to store space data
        window.spaceData = {
            id: "{{space.id}}",
            price: "{{space.price_per_night}}",
            availabilityData: JSON.parse('{{space.dates_available_dict|tojson|safe}}')
        };
    </script>
    <script src="/static/booking.js"></script>
</body>

</html>